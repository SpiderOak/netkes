<%inherit file="main.html" />

<%def name="title()">Settings - ${parent.title()}</%def>

<%def name="head()"></%def>

<%def name="top_of_head()">
</%def>

<%def name="scripts()">
<script src="/static/blue_common/scripts/jquery.form.js"></script>
<script type="text/javascript"> 
    var error = ${'true' if error else 'false'};
var empty_ip_block_form = '';
function update_form(new_form, total){
    new_form.find(':input').each(function() {
        var name = $(this).attr('name').replace('-' + (total-1) + '-','-' + total + '-');
        var id = 'id_' + name;
        $(this).attr({'name': name, 'id': id});
    });
}

function add_ip_block_form(){
    var new_form = empty_ip_block_form.clone(true);
    var total = parseInt($('#id_ip_blocks-TOTAL_FORMS').val());
    update_form(new_form);
    $('#id_ip_blocks-TOTAL_FORMS').val(1 + total);
    $('#ip_blocks > tbody').append(new_form);
}

$(function(){
    empty_ip_block_form = $('#ip_blocks > tbody > tr:last').clone();
    if(!error){
        $('#ip_blocks > tbody > tr:last').remove();
    }else{
        empty_ip_block_form.children(':first').html('');
        empty_ip_block_form.clearForm();
        $('ul', empty_ip_block_form).remove()
    }
    $('#id_ip_blocks-TOTAL_FORMS').val($('#id_ip_blocks-TOTAL_FORMS').val() - 1);
    $('#add_ip_block').click(add_ip_block_form);
});
</script>
</%def>

<%def name="body_classes()">password ${parent.body_classes()} grassy</%def>
<%def name="container()">
<h1 class="header">Enterprise Partner: <span>${username}</span></h1>
<div class="recenter">
<div class="division">
${parent.progressbar()}
</div>
</div>
% if saved:
<p id="saved" class="bigger">Changes saved successfully!</p>
% endif
<div id="s_pass" class="section">
<h2>Change Password</h2>
<form method="post">
    <fieldset>
        <table class="table" style="width:400px">
        %for field in password_form:
            <tr><td>
            ${field.label_tag()}
            </td><td>
                ${field}
            </td></tr>
                %if field.errors:
                <span class="help-inline">
                    %for error in field.errors:
                        ${error}
                    %endfor
                %else:
                    <label for="id_${field.name}">
                    </label>
                </span>
                %endif
        %endfor
        </table>
    </fieldset>
    <input type='hidden' value='password' name='form'>
    <input type='submit' value="Change Password" class="btn btn-primary">
</form>
</div>
</%def>
