<%inherit file="main.html" />

<%def name="title()">SpiderOak Online Backup and Sync White Label Program - ${parent.title()}</%def>

<%def name="head()"></%def>

<%def name="top_of_head()">
    <link rel="stylesheet" href="/static/v0.1/styles/bootstrap.min.css" />
    <link rel="stylesheet" href="/static/v0.1/styles/enterprise.css" />
</%def>

<%def name="scripts()">
<script src="/static/v0.1/scripts/jquery.form.js"></script>
<script type="text/javascript"> 
    var error = ${'true' if error else 'false'};
var empty_group_form = '';
var empty_ip_block_form = '';
function update_form(new_form, total){
    new_form.find(':input').each(function() {
        var name = $(this).attr('name').replace('-' + (total-1) + '-','-' + total + '-');
        var id = 'id_' + name;
        $(this).attr({'name': name, 'id': id});
    });
}

function add_group_form(){
    var new_form = empty_group_form.clone(true);
    var total = parseInt($('#id_groups-TOTAL_FORMS').val());
    update_form(new_form);
    $('#id_groups-TOTAL_FORMS').val(1 + total);
    $('#groups > tbody').append(new_form);
    $('select :nth-child(1)', new_form).attr('selected', 'selected');
    $(':nth-child(3)', new_form).attr('selected', 'selected');
    new_form.children(':nth-child(3)').children().attr('checked', 'checked')
}

function add_ip_block_form(){
    var new_form = empty_ip_block_form.clone(true);
    var total = parseInt($('#id_ip_blocks-TOTAL_FORMS').val());
    update_form(new_form);
    $('#id_ip_blocks-TOTAL_FORMS').val(1 + total);
    $('#ip_blocks > tbody').append(new_form);
}

$(function(){
    empty_group_form = $('#groups > tbody > tr:last').clone();
    if(!error){
        $('#groups > tbody > tr:last').remove();
    }else{
        empty_group_form.children(':first').html('');
        empty_group_form.clearForm();
    }
    $('#id_groups-TOTAL_FORMS').val($('#id_groups-TOTAL_FORMS').val() - 1);
    $('#add_group').click(add_group_form);

    empty_ip_block_form = $('#ip_blocks > tbody > tr:last').clone();
    if(!error){
        $('#ip_blocks > tbody > tr:last').remove();
    }else{
        empty_ip_block_form.children(':first').html('');
        empty_ip_block_form.clearForm();
        $('ul', empty_ip_block_form).remove()
    }
    $('#id_ip_blocks-TOTAL_FORMS').val($('#id_ip_blocks-TOTAL_FORMS').val() - 1);
    $('#add_ip_block').click(add_ip_block_form);
});
</script>
</%def>

<%def name="body_classes()">home ${parent.body_classes()} grassy</%def>

<div class="top_right">
    <a href="${reverse('logout')}" class="logout"><span>Logout</span></a>
</div>

<h1><span>Enterprise Partner:</span> ${user.username}</h1>

Promo Code: ${promo}

% if saved:
<div id="saved">Changes saved successfully!</div>
% endif

<form method="post" action="">
    <h2>Options</h2>
    <div class="span12" id="options">
    <fieldset>
        %for field in options:
        <div class="clearfix ${'error' if field.errors else ''}">
            ${field.label_tag()}
            <div class="input">
                ${field}
                <span class="help-inline">
                %if field.errors:
                    %for error in field.errors:
                        ${error}
                    %endfor
                %else:
                    <label for="id_${field.name}">
                    </label>
                %endif
                <span>
                
            </div>
        </div><!-- /clearfix -->
        %endfor
    </fieldset>
    </div>
% if features.group_permissions:
    ${groups.management_form}
    <h2>Groups</h2>
    <table id="groups">
        <thead>
            <tr>
                <th>Group ID</th>
                <th>Plan</th>
                <th>Allow WebAPI</th>
                <th>Require Domain for Windows Install</th>
                <th>Delete Group</th>
            </tr>
        </thead>
        <tbody>
            % for form in groups.forms:
            <tr>
                <td>${form.initial.get('group_id', '')}</td>
                % for x, field in enumerate(form.visible_fields()):
                <td>
                    % if not x:
                        % for hidden in form.hidden_fields():
                        ${hidden}
                        % endfor
                    % endif
                    ${field}
                </td>
                % endfor
            </tr>
            % endfor
        </tbody>
    </table>
    <input type="button" value="Add Group" id="add_group" class="btn">
% endif
% if features.signup_restrictions:
    ${ip_blocks.management_form}
    <h2>Consumer Signup Restriction Netblocks</h2>
    <table id="ip_blocks">
        <thead>
            <tr>
                <th>IP Block ID</th>
                <th>IP Block</th>
                <th>Delete IP Block</th>
            </tr>
        </thead>
        <tbody>
            % for y, form in enumerate(ip_blocks.forms):
            <tr>
                <td>${form.initial.get('id', '')}</td>
                % for x, field in enumerate(form.visible_fields()):
                <td>
                    % if not x:
                        % for hidden in form.hidden_fields():
                            ${hidden}
                        % endfor
                    % endif
                    ${field}
                    ${field.errors}
                </td>
                % endfor
            </tr>
            % endfor
        </tbody>
    </table>
    <input type="button" value="Add IP Block" id="add_ip_block" class="btn">
    <br /><br />
% endif
    <input type='submit' value="Save Changes" class="btn primary" id="change_password">
    <input type='hidden' value='management' name='form'>
</form>
<h2>Change Password</h2>
<form method="post">
    <fieldset>
        %for field in password_form:
        <div class="clearfix">
            ${field.label_tag()}
            <div class="input">
                ${field}
                <span class="help-inline">
                %if field.errors:
                    %for error in field.errors:
                        ${error}
                    %endfor
                %else:
                    <label for="id_${field.name}">
                    </label>
                %endif
                <span>
                
            </div>
        </div><!-- /clearfix -->
        %endfor
    </fieldset>
    <input type='hidden' value='password' name='form'>
    <input type='submit' value="Change Password" class="btn primary">
</form>
