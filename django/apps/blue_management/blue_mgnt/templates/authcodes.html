{% extends "base.html" %}
{% load filter_todate %}
{% block title %}Auth Codes - Management Console{{ block.super }}{% endblock %}
{% block body_classes %}authcodes {{ block.super }}{% endblock body_classes %}
{% block breadcrumb %}<a href="{% url 'blue_mgnt:manage' %}">Back to Manage</a>{% endblock breadcrumb %}
{% block modal_options %}{% include "partials/add-authcode-widget.html" with active="manage" %}{% endblock modal_options %}
{% block navtab %}{% include "partials/navtab-widget.html" with active="manage" %}{% endblock navtab %}
{% block content %}
<h1 class="page-header">
	<i class="ss-icon">&#x1F511;</i> Auth Codes
    <div class="actions">
		<button id="add-widget" class="button button-primary-basic">Create Code</button>
        <form action="{% url 'blue_mgnt:users' %}" method="GET">
            <input name="show_disabled" type="hidden" value="{{ show_disabled }}">
            <input type="text" class="widget-search-input" value="{{ search }}" placeholder="Find Auth Codes">
            <input type="submit" class="search-button ss-icon" value="&#x1F50E;">
        </form>
	</div>
</h1>
    <table id="groups" class="widget-table">
        <thead>
            <tr class="bigger">
                <th>Token</th>
                <th>Created</th>
                <th>Expires</th>
                <th>Single Use?</th>
                <th>No Devices?</th>
                <th>Used</th>
                <th></th>
            </tr>
        </thead>
        <tbody>
            {% for code in codes %}
            <tr{% if code.new_token %} class="success"{% endif %}>
                    <td>{{ code.token }}</td>
                    <td>{{ code.date_created|todate }}</td>
                    <td>{{ code.expiry|todate }}</td>
                    <td>{{ code.no_devices_only }}</td>
                    <td>{{ code.single_use_only }}</td>
                    <td>{{ code.used }}</td>
                    <td>
                        {% if code.active %}
                        <form method="post" action="{% url 'blue_mgnt:auth_codes' %}?show_inactive={{show_inactive }}">
                            {% csrf_token %}
                            <input type='submit' 
                                value="Disable" 
                                class="button button-muted" 
                                id="edit_share" 
                                style="display: inline-block">
                            <input type='hidden' value='disable_code' name='form'>
                            <input type='hidden' value='{{ code.token }}' name='token'>
                        </form>
                        {% else %}
                            <span style="color:#ff0000">Disabled</span>
                        {% endif %}
                    </td>
                </tr>
            {% endfor %}
        </tbody>
    </table>

    {% if page > 1 %}
    {% block pagination %}{% include "partials/pagination-widget.html" %}{% endblock pagination %}
    {% endif %}
    <div class="widget-actions">
        <a href="{% url 'blue_mgnt:auth_codes' %}?show_inactive={{ show_inactive|yesno:"0, 1" }}" 
            class="button button-muted">
            {{ show_inactive|yesno:"Hide Disabled, Show Disabled" }} Auth Codes
        </a>
    </div>
{% endblock content %}
