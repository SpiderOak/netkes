{% extends "base.html" %}

{% block title %}Management Console - {{ block.super }}{% endblock %}

{% block body_classes %}shares {{ block.super }}{% endblock body_classes %}
{% block breadcrumb %}<a href="#">Back to Something</a>{% endblock breadcrumb %}
{% block modal_options %}{% endblock modal_options %}
{% block navtab %}{% include "partials/navtab-widget.html" with active="shares" %}{% endblock navtab %}
{% block content %}
<h1 class="page-header">
	<i class="ss-icon">&#xEE00;</i> Shares
    <div class="actions">
        <form action="{% url 'blue_mgnt:shares' %}" method="GET">
            <input name="show_disabled" type="hidden" value="{{ show_disabled }}">
            <input type="text" class="widget-search-input" value="{{ search }}" placeholder="Find Shares">
            <input type="submit" class="search-button ss-icon" value="&#x1F50E;">
        </form>
	</div>
</h1>
<form action="{% url 'blue_mgnt:shares' %}" method="POST" action="">
    <table id="groups" class="widget-table">
        <thead>
            <tr class="bigger">
                <th>Name</th>
                {% if features.email_as_username %}
                <th>Email</th>
                {% else %}:
                <th>Username</th>
                {% endif %}
                <th>Shares</th>
            </tr>
        </thead>
        <tbody>
            {% for user in users %}
                <tr>
                    <td>{{ user.name }}</td>
                    {% if features.email_as_username %}
                    <td>{{ user.email }}</td>
                    {% else %}:
                    <td>{{ user.username }}</td>
                    {% endif %}
                    <td>${len(user['shares'])}</td>
                </tr>
                <tr class="shares_table"><td colspan="3">
                    <table>
                    <thead>
                        <tr>
                            <th>Name</th>
                            <th>Room Key</th>
                            <th>URL</th>
                            <th>Description</th>
                            <th>Creation Time</th>
                            <th>Update Time</th>
                            <th></th>
                        </tr>
                    </thead>
                    <tbody>
                        {% for share in user.shares %}
                        <tr>
                            <td title="{{ share.name }}">{{ share.name }}</td>
                            <td title="{{ share.room_key }}">{{ share.room_key }}</td>
                            <td title="{{ share_url }}/browse/share/{{ user.share_identifier }}/{{ share.room_key }}">
                                <a href="{{ share_url }}/browse/share/{{ user.share_identifier }}/{{ share.room_key }}">
                                    {{ share_url }}/browse/share/{{ user.share_identifier }}/{{ share.room_key }}
                            </a></td>
                            <td title="{% if share.description %} {{ share.description }} {% endif %}">{% if share.description %} {{ share.description }} {% endif %}</td>
                            <td title="{{ share.creation_time }}">{{ share.creation_time }}</td>
                            <td title="{{ share.update_time }}">{{ share.update_time }}</td>
                            <td>
                                <form method="post" action="{% url 'blue_mgnt:shares' %}">
                                    <input type='submit' 
                                    value="{{ share.enabled|yesno:"Disable, Enable" }} Share" 
                                        class="button button-primary" 
                                        id="edit_share" 
                                        style="display: inline-block">
                                    <input type='hidden' value='edit_share' name='form'>
                                    <input type='hidden' value='{{ share.room_key }}' name='room_key'>
                                    <input type='hidden' value='{{ share.enabled }}' name='enabled'>
                                    <input type='hidden' value='{{ user.email }}' name='email'>
                                </form>
                            </td>
                        </tr>
                        {% endfor %}
                    </tbody>
                    </table>
                </td></tr>
            {% endfor %}
        </tbody>
    </table>
</form>
    <div id="pagination" class="bigger" style="text-align:center">
        {% if page > 1 %}
        <a href="{% url 'blue_mgnt:shares' page=page|add:'-1' %}">previous</a>
        {% endif %}
        Page {{ page }}
        {% if next_page %}
        <a href="{% url 'blue_mgnt:shares' page=page|add:'1' %}">next</a>
        {% endif %}
    </div>
<form action="{% url 'blue_mgnt:shares' %}" method="post" action="" style="clear:both">
    <div style="text-align:center">
        <input type='submit' value="{{ sharing_enabled|yesno:"Disable, Enable" }} Shares" class="button button-primary" id="edit_shares">
        <input type='hidden' value='{{ sharing_enabled }}' name='sharing_enabled'>
        <input type='hidden' value='edit_shares' name='form'>
    </div>
</form>
</div>
{% endblock content %}
