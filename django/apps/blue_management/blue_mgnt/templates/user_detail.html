{% extends "base.html" %}
{% load filter_todate %}

{% block title %}Management Console - {{ block.super }}{% endblock %}

{% block body_classes %}home {{ block.super }}{% endblock body_classes %}
{% block breadcrumb %}<a href="#">Back to Something</a>{% endblock breadcrumb %}
{% block modal_options %}{% include "partials/add-user-widget.html" with active="users" %}{% endblock modal_options %}
{% block navtab %}{% include "partials/navtab-widget.html" with active="users" %}{% endblock navtab %}
{% block content %}
<h1 class="page-header">
	<i class="ss-icon">&#x1F464;</i> User Detials
    <div class="actions">
		<button id="add-user" class="button button-primary">Add user</button>
        <form action="{% url 'blue_mgnt:users' %}" method="GET">
            <input name="show_disabled" type="hidden" value="{{ show_disabled }}">
            <input type="text" class="widget-search-input" value="{{ search }}" placeholder="Find Users by Name or Email">
            <input type="submit" class="search-button ss-icon" value="&#x1F50E;">
        </form>
	</div>
</h1>


{% if saved %}
<p id="saved">Changes saved successfully!</p>
{% endif %}

<form method="POST" action="{% url 'blue_mgnt:user_detail' email %}">
    <div class="" id="options">
        <fieldset>
            <table class="widget-table">
            {% if not features.email_as_username %}
            <tr>
                <td><label>Username</label></td>
                <td>{{ api_user.username }}</td>
            </tr>
            {% endif %}
            {% for field in user_form %}
            <tr>
                <td>
                    <div class="{{ field.errors|yesno:"error, ''" }}">
                        {{ field.label_tag }}
                    </div>
                </td>
                <td>
                    {{ field }}
                    {% if field.errors %}
                        <br />
                        {% for error in field.errors %}
                        <span class="table_errors">
                            {{ error }}
                        </span>
                        {% endfor %}
                    {% else %}
                        <label for="id_{{ field.name }}">
                        </label>
                    {% endif %}
                </td>
            </tr>
            {% endfor %}
            <tr>
                <td><label>Devices</label></td>
                <td>{{ api_user.num_devices }}</td>
            </tr>
            <tr>
                <td><label>GBs Stored</label></td>
                <td>{{ api_user.bytes_stored|filesizeformat }}</td>
            </tr>
            <tr>
                <td><label>Storage GBs</label></td>
                <td>{{ api_user.storage_bytes|filesizeformat }}</td>
            </tr>
            <tr>
                <td><label>Creation Time</label></td>
                <td>{{ api_user.creation_time|todate }}</td>
            </tr>
            <tr>
                <td><label>Last Login</label></td>
                <td>{% if api_user.last_login %}
                    {{ api_user.last_login|todate }}
                {% else %}
                    No login recorded
                {% endif %}
                </td>
            </tr>
            <tr>
                <td><label>Enabled</label></td>
                <td>{{ api_user.enabled }}</td>
            </tr>
            <tr><td colspan="2">
                <input type='submit' value="Save Changes" class="button button-primary" id="edit_user">
                <input type='hidden' value='edit_user' name='form'>
</form>
            </td></tr>
            {% if devices %}
            <tr><td colspan="2"><h2>Devices</h2></td></tr>
            {% endif %}
            {% for device in devices %}
            <tr>
                <td><label>Device ID</label></td>
                <td>{{ device.device_id }}</td>
            </tr>
            <tr>
                <td><label>Name</label></td>
                <td>{{ device.name }}</td>
            </tr>
            <tr>
                <td><label>Creation Time</label></td>
                <td>{{ device.creation_time|todate }}</td>
            </tr>
            <tr>
                <td><label>Reinstalled</label></td>
                <td>
                    {% if device.reinstalled %}
                        {{ device.reinstalled|todate }}
                    {% else %}
                        No recorded reinstall
                    {% endif %}
                </td>
            </tr>
            <tr>
                <td><label>Last Login</label></td>
                <td>
                {% if device.last_login %}
                    {{ device.last_login|todate }}
                {% else %}
                    No login recorded
                {% endif %}
                </td>
            </tr>
            <tr>
                <td><label>Last Backup Complete</label></td>
                <td>
                {% if device.last_backup_complete %}
                    {{ device.last_backup_complete|todate }}
                {% else %}
                    No backup recorded
                {% endif %}
                </td>
            </tr>
            {% endfor %}
            {% if shares %}
            <tr><td colspan="2"><h2>Shares</h2></td></tr>
            {% for share in shares %}
            <tr>
                <td><label>Room Key</label></td>
                <td>{{ share.room_key }}</td>
            </tr>
            <tr>
                <td><label>URL</label></td>
                <td>
                    <a href="{{ share_url }}/browse/share/{{ api_user.share_identifier }}/{{ share.room_key }}">{{ share_url }}/browse/share/{{ api_user.share_identifier }}/{{ share.room_key }}</a>
                </td>
            </tr>
            <tr>
                <td><label>Description</label></td>
                <td>{{ share.description }}</td>
            </tr>
            <tr>
                <td><label>Password Required</label></td>
                <td>{{ share.password_required }}</td>
            </tr>
            <tr>
                <td><label>Creation Time</label></td>
                <td>
                {% if share.creation_time %}
                    {{ share.creation_time|todate }}
                {% endif %}
                </td>
            </tr>
            <tr>
                <td><label>Update Time</label></td>
                <td>
                {% if share.update_time %}
                    {{ share.update_time|todate }}
                {% endif %}
                </td>
            </tr>
            <tr>
                <td><label>Status</label></td>
                <td>{{ share.enabled|yesno:"Enabled, Disabled" }}</td>
            </tr>
            <tr>
                <td colspan="2">
                    <form method="post" action="{% url 'blue_mgnt:user_detail' email %}">
                        <input type='submit' 
                        value="{{ share.enabled|yesno:'Disable, Enable' }} Share" 
                               class="button button-primary" 
                               id="edit_share" 
                              >
                        <input type='hidden' value='edit_share' name='form'>
                        <input type='hidden' value='{{ share.room_key }}' name='room_key'>
                        <input type='hidden' value='{{ share.enabled }}' name='enabled'>
                    </form>
                </td>
            </tr>
            {% endfor %}
            {% endif %}
            </table>
        </fieldset>
        <div>
        </div>
    </div>
{% if not features.ldap %}
    {% if not api_user.num_devices %}
        <form method="post" action="{% url 'blue_mgnt:user_detail' email %}">
            <input type='hidden' value='resend_email' name='form'>
            <input type='submit' value="Re-send Activation Email" class="button button-primary">
        </form>
    {% endif %}
{% endif %}
</div>
</div>

{% endblock content %}
